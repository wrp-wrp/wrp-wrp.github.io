+++
date = '2025-11-20T12:01:45+08:00'
draft = false
math = true
title = '计算机网络按层复习'
summary = "按网络层次（物理/链路/网络/传输/应用）整理的计算机网络复习笔记，包含常见物理层线路编码与调制简介。"
+++

# 按层整理的计算机网络复习笔记

本文按网络分层（物理层、链路层、网络层、传输层、应用层）整理要点，并在物理层补充常见线路编码与带通调制的简介，便于复习与查阅。

---

## 体系结构与参考模型

+ **OSI 七层模型** vs **TCP/IP 五层模型**
  ![OSI vs TCP/IP](image1.png)

+ **TCP/IP 五层模型各层传输单元**
  ![TCP/IP Layers](image2.png)

---

## 物理层（Physical Layer） — 编码与调制

### 采样与信道极限
 - **采样定理**：采样频率 $f_s > 2 f_{max}$。
 - **奈奎斯特（无噪声）**：最大速率 $$C_{max} = 2W\\log_2 V\\quad(\\text{bps})$$。
 - **香农（有噪声）**：信道容量 $$C = W\\log_2(1+S/N)\\quad(\\text{bps})$$。

### 线路编码详解（基带传输）

#### 1. 不归零编码 (NRZ - Non-Return to Zero)
*   **NRZ-L (Level)**：高电平代表 1，低电平代表 0。
*   **NRZI (Inverted)**：电平翻转代表 1，电平保持代表 0。
*   **缺点**：存在直流分量；缺乏同步能力（连续的 0 或 1 会导致时钟漂移）。

#### 2. 曼彻斯特编码 (Manchester Encoding)
*   **原理**：将每个比特周期分为两半，**在周期中间进行电平跳变**。
    *   **跳变即时钟**：中间的跳变既作为数据信号，也作为时钟信号（Self-clocking）。
    *   **编码规则** (IEEE 802.3 标准)：
        *   **1**：从低电平跳变到高电平 ($\uparrow$)。
        *   **0**：从高电平跳变到低电平 ($\downarrow$)。
        *   *(注：G.E. Thomas 标准与之相反)*
*   **优点**：
    *   **自带时钟同步**：接收端容易提取时钟信号。
    *   **无直流分量**：正负电平相互抵消。
*   **缺点**：
    *   **频带利用率低**：信号频率是数据率的 2 倍（因为每个比特至少跳变一次），需要双倍带宽。
*   **应用**：10BASE-T 以太网。

#### 3. 差分曼彻斯特编码 (Differential Manchester)
*   **原理**：
    *   **周期中间**：始终有跳变（用于时钟同步）。
    *   **位开始处**：
        *   **有跳变** $\rightarrow$ 表示 **0**。
        *   **无跳变** $\rightarrow$ 表示 **1**。
*   **优点**：
    *   继承了曼彻斯特编码的优点（自同步、无直流）。
    *   **抗干扰性更强**：利用电平跳变的相对关系而非绝对极性来表示数据，对噪声更不敏感。
*   **应用**：令牌环网 (Token Ring)。

#### 4. AMI (Alternate Mark Inversion)
*   **规则**：**0** 为零电平；**1** 为正负电平交替（例如：+V, -V, +V...）。
*   **特点**：无直流分量，但连续的 0 仍可能导致同步丢失（需配合扰码技术如 HDB3）。

### 线码与块编码（用于时钟、直流平衡与效率提升）
 - **4B/5B**：将 4 比特映射为 5 比特代码（保证足够的转换以恢复时钟），常与 MLT-3 配合用于 100BASE-TX。
 - **MLT-3**：多电平传输（多用于 100BASE-TX），电平序列循环以降低频谱带宽。

### 带通调制（用于无线与宽带链路）
 - **ASK (Amplitude Shift Keying)**：振幅改变表示比特。
 - **FSK (Frequency Shift Keying)**：频率改变表示比特（例如蓝牙早期使用 FSK）。
 - **PSK (Phase Shift Keying)**：相位改变表示比特；QPSK 用两个比特/符号。
 - **QAM (Quadrature Amplitude Modulation)**：幅度与相位联合，用于高阶星座（例如 16-QAM、64-QAM），提高频谱效率。

### 实用注记
 - 10BASE-T 使用 Manchester；100BASE-TX 使用 4B/5B + MLT-3；千兆与更高速以太网使用更复杂的 PAM 与多电平方案。

---

## 链路层（Data Link Layer） — MAC、帧结构与差错检测

 - 以太网帧：前导码 + 目的/源 MAC + 类型/长度 + 数据 + CRC；最小载荷 46B（不足填充）。
 - 差错检测：CRC（循环冗余校验）。
 - 地址解析：ARP 将 IP 映射为 MAC。

### 多址访问（MAC）
 - **信道划分**：TDMA / FDMA / CDMA（重负载场景）。
 - **随机访问**：纯 ALOHA、时隙 ALOHA、CSMA、CSMA/CD（有线）、CSMA/CA（无线）。
 - **轮流方法**：轮询、令牌环（Token Ring）。

### CSMA/CD (Carrier Sense Multiple Access with Collision Detection)
*用于有线以太网（半双工）*
 - **核心机制**：
   1. **先听后发 (Carrier Sense)**：发送前监听信道，空闲则发送，忙则等待。
   2. **边发边听 (Collision Detection)**：发送过程中持续监听信道电平。
   3. **冲突停止**：一旦检测到冲突（电平叠加），立即停止发送数据，并发送**人为干扰信号 (Jamming Signal)** 强化冲突，通知所有站点。
   4. **随机重发**：执行二进制指数退避算法，等待一段时间后重试。
 - **关键参数**：
   - **争用期 (Contention Period)**：$2\tau$ (两倍端到端传播时延)。
   - **最小帧长**：$L_{min} = 2\tau \times R$。必须保证在发送完一帧之前，信号能跑个来回，确保能检测到最远端的冲突。
 - **二进制指数退避算法 (Truncated Binary Exponential Backoff)**：
   - **目的**：动态适应网络负载。冲突次数越多，说明网络负载越重，需要等待更长时间以减少再次冲突的概率。
   - **算法流程**：
     1. 确定基本退避时间，一般为争用期 $2\tau$。
     2. 定义重传次数 $k$，且 $k = \min(\text{重传次数}, 10)$（截断机制，超过 10 次后范围不再扩大）。
     3. 从整数集合 $[0, 1, \dots, 2^k - 1]$ 中随机取出一个数 $r$。
     4. 重传所需的退避时间为 $r \times 2\tau$。
     5. 当重传达 16 次仍不能成功时，丢弃该帧并向高层报错。
   - **举例**：
     - 第 1 次冲突：$k=1$，范围 $\{0, 1\}$，等待 $0$ 或 $2\tau$。
     - 第 2 次冲突：$k=2$，范围 $\{0, 1, 2, 3\}$，最大等待 $6\tau$。
     - ...
     - 第 10 次冲突：$k=10$，范围 $\{0, \dots, 1023\}$。
 - **效率**：近似公式 $$\text{Efficiency} = \frac{1}{1+5t_{prop}/t_{trans}}$$。

### 信道利用率 (Channel Utilization)
 - **定义**：发送方处于发送数据状态的时间占总时间的比例。
 - **停等协议 (Stop-and-Wait)**：
   - 发送一帧的时间：$T_{frame} = L/R$。
   - 往返时间：$RTT$。
   - 利用率公式：
     $$ U = \frac{T_{frame}}{T_{frame} + RTT} = \frac{1}{1 + 2a} $$
     其中 $a = \frac{T_{prop}}{T_{frame}}$ (传播时延 / 发送时延)。
 - **滑动窗口协议 (Sliding Window)**：
   - 设窗口大小为 $N$。
   - 若 $N \times T_{frame} < T_{frame} + RTT$，则 $U = \frac{N \times T_{frame}}{T_{frame} + RTT}$。
   - 若 $N \times T_{frame} \ge T_{frame} + RTT$，则 $U = 1$ (信道被填满)。

---

## 网络层（Network Layer） — IP 与路由

 - **IP**：无连接、不可靠，负责寻址与分片（MTU 限制）。
 - **路由**：静态/动态（RIP、OSPF、BGP 概念）。
 - **子网与掩码**：CIDR 表示法，注意网络/主机位划分。

### IP 协议关键字段
 - **TTL (Time To Live)**：生存时间，每经过一个路由器减 1，减至 0 丢弃，防止环路。
 - **Protocol**：上层协议标识（6=TCP, 17=UDP, 1=ICMP）。
 - **Fragment**：标识、标志、片偏移，用于分片重组。

### ICMP (Internet Control Message Protocol)
 - 用于差错报告（如目的不可达、TTL 超时）和网络探测（Ping, Traceroute）。

---

## 传输层（Transport Layer） — 可靠性与拥塞控制

### 可靠数据传输（RDT）演进
 - **RDT 1.0**：理想信道。
 - **RDT 2.x**：处理比特误码，引入 ACK/NAK 与序列号。
 - **RDT 3.0**：处理丢包，引入超时重传与定时器。

### 流水线协议
 - **GBN (Go-Back-N)**：接收端单一累积 ACK，超时重传窗口内所有未确认分组。
 - **SR (Selective Repeat)**：接收端可缓存乱序分组，只重传超时分组。

### TCP / UDP
 - **TCP**：面向连接，可靠传输，拥塞控制（慢启动、拥塞避免、快速重传/恢复）、流量控制（滑动窗口）。
 - **UDP**：无连接、无保证，适合实时/简单请求场景（如 DNS、实时媒体）。

### TCP 拥塞控制算法变体
| 算法 | 核心机制 | 特点 |
| :--- | :--- | :--- |
| **TCP Tahoe** | 慢启动 + 拥塞避免 + 快速重传 | 任何丢包（超时或 3 个重复 ACK）都将 `cwnd` 重置为 1，进入慢启动。效率较低。 |
| **TCP Reno** | + **快速恢复** | 收到 3 个重复 ACK 时，执行快速恢复（`cwnd` 减半而非重置为 1），跳过慢启动。 |
| **TCP NewReno** | 改进的快速恢复 | 解决 Reno 在一个窗口内多个包丢失时效率低下的问题。 |
| **TCP CUBIC** | 三次函数增长 | Linux 默认算法。使用三次函数替代线性增长，更适合高带宽延迟积（BDP）网络。 |
| **TCP BBR** | 基于模型 (Model-based) | Google 开发。不基于丢包，而是探测带宽和 RTT，旨在最大化吞吐量并最小化延迟。 |

### TCP 连接管理
 - **三次握手 (建立连接)**：
   1. **SYN** (seq=x)
   2. **SYN+ACK** (seq=y, ack=x+1)
   3. **ACK** (seq=x+1, ack=y+1)
 - **四次挥手 (释放连接)**：
   1. **FIN** (主动关闭方)
   2. **ACK** (被动关闭方)
   3. **FIN** (被动关闭方)
   4. **ACK** (主动关闭方，进入 TIME_WAIT 等待 2MSL)

---

## 应用层（Application Layer） — 协议演进与常见服务

### HTTP
 | 版本 | 连接 | 核心 | 说明 |
 |---:|:---:|:---|:---|
 | HTTP/1.0 | 短连接 | 文本 | 每请求建连接 |
 | HTTP/1.1 | 长连接 | 管线化 | Keep-Alive、管线化（有限应用） |
 | HTTP/2 | 多路复用 | 二进制分帧、HPACK | 降低头部开销、单连接多流 |
 | HTTP/3 | QUIC/UDP | 0-RTT、连接迁移 | 解决 TCP 层面队头阻塞 |

### 邮件与其他服务
 - **SMTP**：发送。
 - **POP3 / IMAP**：接收（POP3 单端，IMAP 多端同步）。
 - **DNS**：域名解析，UDP/TCP 混合使用。

---

## 实验与常用速算（附录）

 - **时延带宽积**：$$\\text{BDP} = \\text{带宽 (bps)} \\times \\text{往返时延 (s)}$$。
 - **16 进制阅读**：2 个 hex 字符 = 1 字节，1 hex 字符 = 4 bit。

---

如需，我可以：
 - 在物理层加入每种编码的示意图或时序图（SVG/PNG）。
 - 将某一层展开为练习题（选择题/计算题）。

您想先把哪部分进一步展开（例如：某些编码的时序图，或 TCP 拥塞控制的流程图）？